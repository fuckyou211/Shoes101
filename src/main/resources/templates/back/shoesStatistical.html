<!DOCTYPE html>
<html>
<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>101Shoes | 后台管理</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../font-awesome/css/font-awesome.css" rel="stylesheet">

    <link href="../css/animate.css" rel="stylesheet">
    <link href="../css/style.css" rel="stylesheet">
    <style>
        .span-slesct-small{
            padding: 5px;
        }
    </style>

</head>
<body>
<div id="wrapper">
    <!-- 左侧导航栏 -->
    <div id="navigate">
        <navigate></navigate>
    </div>

    <!-- 右边主要部分 -->
    <div id="page-wrapper" class="gray-bg">
        <!-- 正上方一小条 -->
        <div id="navigate-assist">
            <navigate-assist></navigate-assist>
        </div>
        <div class="wrapper wrapper-content animated fadeInRight">
            <div class="row" id="webStatistical">
                <div class="col-lg-3">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <span class="label label-success pull-right">{{theTime}}</span>
                            <h5>交易</h5>
                        </div>
                        <div class="ibox-content">
                            <h1 class="no-margins">{{income}}</h1>
                            <div class="stat-percent font-bold text-success">60% <i class="fa fa-level-up"></i></div>
                            <small>总金额</small>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <span class="label label-info pull-right">{{theTime}}</span>
                            <h5>订单</h5>
                        </div>
                        <div class="ibox-content">
                            <h1 class="no-margins">{{orders}}</h1>
                            <div class="stat-percent font-bold text-info">20% <i class="fa fa-level-up"></i></div>
                            <small>成交量</small>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <span class="label label-primary pull-right">{{theTime}}</span>
                            <h5>访问</h5>
                        </div>
                        <div class="ibox-content">
                            <h1 class="no-margins">{{visit}}</h1>
                            <div class="stat-percent font-bold text-navy">44% <i class="fa fa-level-up"></i></div>
                            <small>浏览次数</small>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <span class="label label-danger pull-right">{{theTime}}</span>
                            <h5>用户</h5>
                        </div>
                        <div class="ibox-content">
                            <h1 class="no-margins">{{newUser}}</h1>
                            <div class="stat-percent font-bold text-danger">38% <i class="fa fa-level-down"></i></div>
                            <small>新用户</small>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-12">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <!--<h5>销量</h5>-->
                            <span class="col-md-3" id="selectChart" v-if="sday">
                                	<span class="span-slesct-small">选择:</span>
                                	<span v-if="syear">
	                                	<select class="form-inline" name="selYear" onchange="changeYear()">
	                                        <option  v-for="n in 4" :value="annian[n-1]" :selected="checkthisYear(annian[n-1])">{{annian[n-1]}}</option>
	                                    </select>
	                                    <span class="span-slesct-small">年</span>
                                	</span>

                                	<span v-if="syue">
	                                	<select class="form-inline" name="selMonth" onchange="changeMonth()">
	                                        <option :value="n" v-for="n in 12" :selected="checkthisMonth(n)" >{{anyue[n-1]}}</option>
	                                    </select>
	                                    <span class="span-slesct-small">月</span>
                                	</span>

                                </span>
                            <div class="pull-right">
                                <div class="btn-group">
                                    <button type="button" class="btn btn-xs btn-white " onclick="changeChart(this,'day')">按天</button>
                                    <button type="button" class="btn btn-xs btn-white active" onclick="changeChart(this,'month')">按月</button>
                                    <button type="button" class="btn btn-xs btn-white" onclick="changeChart(this,'year')">按年</button>
                                </div>
                            </div>
                        </div>
                        <div class="ibox-content">
                            <div class="row">
                                <div class="col-lg-9">

                                    <div class="flot-chart">
                                        <div id="dashboard-echart" class="flot-chart-content"></div>
                                    </div>
                                </div>
                                <div class="col-lg-3">
                                    <ul class="stat-list">
                                        <li>
                                            <h2 class="no-margins">2,346</h2>
                                            <small>Total orders in period</small>
                                            <div class="stat-percent">48% <i class="fa fa-level-up text-navy"></i></div>
                                            <div class="progress progress-mini">
                                                <div style="width: 48%;" class="progress-bar"></div>
                                            </div>
                                        </li>
                                        <li>
                                            <h2 class="no-margins ">4,422</h2>
                                            <small>Orders in last month</small>
                                            <div class="stat-percent">60% <i class="fa fa-level-down text-navy"></i></div>
                                            <div class="progress progress-mini">
                                                <div style="width: 60%;" class="progress-bar"></div>
                                            </div>
                                        </li>
                                        <li>
                                            <h2 class="no-margins ">9,180</h2>
                                            <small>Monthly income from orders</small>
                                            <div class="stat-percent">22% <i class="fa fa-bolt text-navy"></i></div>
                                            <div class="progress progress-mini">
                                                <div style="width: 22%;" class="progress-bar"></div>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-12">
                    <div class="ibox float-e-margins">
                        <div class="ibox-title">
                            <h5>销量TOP-10 </h5>
                            <div class="ibox-tools">
                                <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                    <i class="fa fa-wrench"></i>
                                </a>
                                <ul class="dropdown-menu dropdown-user">
                                    <li><a href="#">销量 TOP-10</a>
                                    </li>
                                    <li><a href="#">销量 Worst-10</a>
                                    </li>
                                </ul>
                                <!--<a class="close-link">
                                    <i class="fa fa-times"></i>
                                </a>-->
                            </div>
                        </div>
                        <div class="ibox-content">
                            <table class="table table-hover" id="top">
                                <thead>
                                <tr>
                                    <th>#</th>
                                    <th>商品名称</th>
                                    <th>销量</th>
                                    <th>同比增长</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <td>1</td>
                                    <td>Samantha</td>
                                    <td><span class="pie">12548</span></td>
                                    <td class="text-navy"> <i class="fa fa-level-up"></i> 40% </td>
                                </tr>
                                <tr>
                                    <td>2</td>
                                    <td>Jacob</td>
                                    <td><span class="pie">226,134</span></td>
                                    <td class="text-warning"> <i class="fa fa-level-down"></i> -20% </td>
                                </tr>
                                <tr >
                                    <td>{{index n}}</td>
                                    <td>{{shoesname}}</td>
                                    <td><span class="pie">{{topsell}}</span></td>
                                    <td class="text-navy"> <i class="fa fa-level-up"></i> 26% </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Mainly scripts -->
<script src="../js/jquery-3.1.1.min.js"></script>
<script src="../js/bootstrap.min.js"></script>
<script src="../js/plugins/metisMenu/jquery.metisMenu.js"></script>
<script src="../js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

<!-- Custom and plugin javascript -->
<script src="../js/inspinia.js"></script>
<script src="../js/plugins/pace/pace.min.js"></script>
<script src="../js/echarts.js"></script>

<script src="../js/vue.js"></script>
<script src="../navigate/navigate.js"></script>


<script>new Vue({el:"#navigate"});new Vue({el:"#navigate-assist"})</script>

<script>
    /**
     * 销售统计
     * 目前先进行简单的统计，就按年，按月，按日来统计销量
     *
     * 按年: 从2018年上线开始，统计到今年所在的年份为止，为了显示效果，
     *       就从2015年开始统计
     *
     * 按月: 可以选择某一年，然后统计该年1到12月份每个月的销量，最多可以选择
     *       今年所在的年份
     *
     * 按日: 选择某一年，某一个月，统计该月每一天的销量，因为每个月分的天数不一样
     *       所以要进行平年闰年的判断
     *
     * 上述统计都按bar（柱形图）方式进行统计
     *
     * 接下来还有各种各样的统计
     * 	1.每个月的有效交易额
     * 	2.每个月的新用户注册量
     *  3.每个月的商城访问量
     * 	（注：以上三个只需要一个值,
     *        还要一个数据，就是本月和上一个月的比值）
     *
     * 	4.每个月每种属性的销量前十
     *     如:  按颜色每个月销量前十的是什么颜色，以及它们的销量是多少
     *          按尺码
     *   		按品牌
     * 			...
     *  5.总销量前十
     *
     * 目前就想到这些，后面继续补充...
     *
     *
     *
     */

    var Yearly = ["2015","2016","2017","2018"];
    var Monthly = ["一","二","三","四","五","六","七","八","九","十","十一","十二"];
    var Dayly = ["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20",
        "21","22","23","24","25","26","27","28","29","30","31"];
    var yearsale = [12000,45897,51235,68451]
    var monthsale = [1000,524,655,999,736,865,1230,785,555,741,683,863];
    var daysale = [12,45,68,78,55,68,63,45,234,56,45,78,12,80,68,75,
        12,99,78,77,68,103,98,69,12,78,68,48,45,21,]

    var mydate = new Date();
    var thisMonth = mydate.getMonth(); //获取当前月份(0-11,0代表1月)
    var thisYear = mydate.getFullYear();//获取当前年
    console.log(thisMonth);
    console.log(thisYear);

    // 基于准备好的dom，初始化echarts实例 dashboard-echart
    var myChart = echarts.init(document.getElementById('dashboard-echart'));

    // 指定图表的配置项和数据
    var option = {
        title: {
            text: '销量'
        },
        tooltip: {},
        legend: {
            data:['销量']
        },
        xAxis: {
            data: Monthly,
            name:"month"
        },
        yAxis: {},
        series: [{
            name: '销量',
            type: 'bar',
            data: [],
            itemStyle: {
                // 设置柱形的颜色
                color: '#12c9a4',
                shadowBlur: 200,
                shadowColor: 'rgba(0, 0, 0, 0.5)'
            }
        }]
    };

    // 使用刚指定的配置项和数据显示图表。
    myChart.setOption(option);


    var webStaVue = new Vue({
        el:'#webStatistical',
        data:{
            theTime:"",
            income:0,
            orders:0,
            visit:0,
            newUser:0
        }
    });

    var chartvue = new Vue({
        el:"#selectChart",
        data:{
            annian:Yearly,
            anyue:Monthly,
            anday:Dayly,
            anyear:[],
            thisMonth:thisMonth,
            thisYear:thisYear,
            sday:true,
            syue:false,
            syear:true,
        },
        methods:{
            checkthisYear:function(year){
                if(year==thisYear){
                    return "selected"
                }
            },
            checkthisMonth:function(month){
                if(month==(thisMonth+1)){
                    return "selected"
                }
            }
        }
    });

    var topvue = new Vue({
        el:"#top-sell",
        data:{
            topsell:[],
            shoesname:[]
        }
    })
    //根据选择，动态加载数据
    function changeChart(obj,type){

        $(".btn-xs.btn-white").removeClass("active");
        $(obj).addClass("active");
        //如果是按日销量
        if(type=='day'){
            //此时选择框的状态应该是：三个都显示
            chartvue.sday=true;
            chartvue.syear=true;
            chartvue.syue=true;
            getDaySell(thisYear,thisMonth+1);
        }
        //如果是按月销量，
        else if(type=='month'){
            chartvue.sday=true;
            chartvue.syear=true;
            chartvue.syue=false;
            getMonthSell(thisYear);
        }
        else if(type=='year'){
            chartvue.sday=false;
            chartvue.syear=false;
            chartvue.syue=false;
            getYearSell();
        }
    }


    //下拉框选择年份
    function changeYear(){
        let yObj = $("select[name='selYear']")[0];
        let sYear =  yObj.options[yObj.selectedIndex].value;
        console.log(sYear);

        //有两种情况
        // 一是按月份，此时只需要获取年份就行
        if(chartvue.syear==true && chartvue.syue==false){
            getMonthSell(sYear);
        }
        //二是按天，这时候就要获取年份和月份
        else if(chartvue.syue==true){
            let mObj = $("select[name='selMonth']")[0];
            let sMonth =  mObj.options[mObj.selectedIndex].value;
            console.log(sMonth);

            getDaySell(sYear,sMonth);
        }

    }

    //下拉框选择月份
    function changeMonth(){
        //能选择月份一定是按天来的
        let yObj = $("select[name='selYear']")[0];
        let sYear =  yObj.options[yObj.selectedIndex].value;
        console.log(sYear);

        let mObj = $("select[name='selMonth']")[0];
        let sMonth =  mObj.options[mObj.selectedIndex].value;
        console.log(sMonth);

        getDaySell(sYear,sMonth);
    }

    //接下来是通过ajax获取数据了;

    function getDaySell(year,month){
        $.post({
            url:"getYmsellsAjax",
            dataType:"json",
            data:{"year":year,"month":month},
            success:function (result) {
                console.log(result);
                loadChart(result.sell,result.date,"day");
            },
            fail: function (err) {
                console.log(err);
            }
      });

    }
    function getMonthSell(year){
        $.post({
            url:"getAYsellsAjax",
            dataType:"json",
            data:{"year":year},
            success:function (result) {
                console.log(result);
                loadChart(result.sell,result.date,"month");
            },
            fail: function (err) {
                console.log(err)
            }
      });
    }

    function getYearSell(){
        $.post({
            url:"getEveryYsell",
            dataType:"json",
            success:function (result) {
                console.log(result);
                loadChart(result.sell,result.date,"year");
            },
            fail: function (err) {
                console.log(err)
            }
      });
    }

    function getstatistical(){
        $.post({
            url:"tocells",
            dataType:"json",
            success:function (result) {
                console.log(result);
                loadData(result.slist);
            },
            fail: function (err) {
                console.log(err)
            }
      });

    }

    //渲染图表
    function loadChart(cell,date,type){

        myChart.setOption({
            xAxis:{
                data:date,
                name:type
            },
            series:{
                data:cell
            }
        });
    }


    function loadData(data){

        webStaVue.theTime = data.yearmonth;//当前时间
        webStaVue.income = data.monthmoney;//有效交易额
        webStaVue.orders = data.monthorder;//本月订单量
        webStaVue.newUser = data.monthregistuser;//本月新用户注册量
    }



</script>
<script>
    var mydate = new Date();
    var thisMonth = mydate.getMonth(); //获取当前月份(0-11,0代表1月)
    var thisYear = mydate.getFullYear();//获取当前年
    console.log(thisMonth);
    console.log(thisYear);

    getstatistical();
    getMonthSell(thisYear);
</script>


</body>
</html>